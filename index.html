<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cash Cartel Microlending Application</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #2c5aa0 0%, #1e3a5f 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c5aa0 0%, #1e3a5f 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .logo {
            max-width: 300px;
            height: auto;
            margin-bottom: 10px;
        }
        .header p {
            font-size: 14px;
            margin-top: 10px;
            opacity: 0.9;
        }
        .form-section {
            padding: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="number"],
        input[type="date"],
        input[type="file"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }
        input:focus {
            outline: none;
            border-color: #2c5aa0;
        }
        .camera-button {
            width: 100%;
            padding: 15px;
            background: #2c5aa0;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 5px;
        }
        .camera-button:hover {
            background: #1e3a5f;
        }
        .preview-image {
            max-width: 200px;
            margin-top: 10px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2c5aa0;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 13px;
        }
        .calculations {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 2px solid #2c5aa0;
        }
        .calc-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .calc-row.total {
            font-weight: 700;
            font-size: 18px;
            color: #2c5aa0;
            border-top: 2px solid #e0e0e0;
            padding-top: 10px;
            margin-top: 10px;
        }
        .terms-box {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            font-size: 10px;
            line-height: 1.4;
            color: #333;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            margin-bottom: 15px;
        }
        .confirmation-box {
            background: #fff;
            padding: 15px;
            border: 2px solid #2c5aa0;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 13px;
        }
        .checkbox-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }
        .signature-pad {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: crosshair;
            background: white;
            width: 100%;
            height: 200px;
            touch-action: none;
        }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #2c5aa0 0%, #1e3a5f 100%);
            color: white;
        }
        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .btn-secondary {
            background: #f5f5f5;
            color: #666;
        }
        h2 {
            margin-bottom: 20px;
            color: #333;
            font-size: 20px;
        }
        .hidden {
            display: none;
        }
        @media (max-width: 600px) {
            .logo {
                max-width: 200px;
            }
            .form-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img class="logo" src="data:image/png;base64,ENDFILE
cat /home/claude/logo_base64.txt >> /mnt/user-data/outputs/index.html
cat >> /mnt/user-data/outputs/index.html << 'ENDFILE2'
" alt="Cash Cartel Microlending">
            <p>Apply ‚àô Verify ‚àô Sign</p>
        </div>

        <form id="loanForm" class="form-section">
            <h2>Personal Information</h2>
            
            <div class="form-group">
                <label for="fullName">Full Name *</label>
                <input type="text" id="fullName" required>
            </div>

            <div class="form-group">
                <label for="idNumber">ID Number *</label>
                <input type="text" id="idNumber" required>
            </div>

            <div class="form-group">
                <label for="email">Email Address *</label>
                <input type="email" id="email" required>
            </div>

            <div class="form-group">
                <label for="phone">WhatsApp Number *</label>
                <input type="tel" id="phone" required>
            </div>

            <div class="form-group">
                <label for="address">Residential Address *</label>
                <input type="text" id="address" required>
            </div>

            <h2 style="margin-top: 30px;">Loan Details</h2>

            <div class="info-box">
                <strong>üìã Loan Terms</strong><br>
                ‚Ä¢ Loan Period: 2-31 days<br>
                ‚Ä¢ Fees include: Interest, initiation, document and banking fees<br>
                ‚Ä¢ Total fees will be calculated based on loan amount
            </div>

            <div class="form-group">
                <label for="loanAmount">Loan Amount (R) *</label>
                <input type="number" id="loanAmount" min="500" max="5000" required>
            </div>

            <div class="form-group">
                <label for="repaymentDate">Repayment Date *</label>
                <input type="date" id="repaymentDate" required>
            </div>

            <div class="calculations">
                <div class="calc-row">
                    <span>Loan Amount:</span>
                    <span id="displayLoanAmount">R 0.00</span>
                </div>
                <div class="calc-row">
                    <span>Total Fees:</span>
                    <span id="displayFees">R 0.00</span>
                </div>
                <div class="calc-row total">
                    <span>Total Payable:</span>
                    <span id="displayTotal">R 0.00</span>
                </div>
            </div>

            <h2 style="margin-top: 30px;">Required Documents</h2>

            <div class="form-group">
                <label>Take Selfie (Live Photo Only) *</label>
                <button type="button" class="camera-button" id="takeSelfie">üì∏ Open Camera for Selfie</button>
                <input type="file" id="selfieInput" accept="image/*" capture="user" class="hidden" required>
                <img id="selfiePreview" class="preview-image hidden">
            </div>

            <div class="form-group">
                <label for="idDoc">Upload ID Document *</label>
                <input type="file" id="idDoc" accept="image/*,.pdf" required>
            </div>

            <div class="form-group">
                <label for="payslip">Upload Payslip *</label>
                <input type="file" id="payslip" accept="image/*,.pdf" required>
            </div>

            <h2 style="margin-top: 30px;">Terms and Conditions</h2>
            
            <div class="terms-box">
                <strong>MICRO-LENDING TERMS & CONDITIONS (SOUTH AFRICA)</strong><br><br>
                
                <strong>1. Loan Agreement</strong><br>
                By submitting this application, I confirm that all information provided is true and correct and that I am applying for a loan subject to approval.<br><br>
                
                <strong>2. Loan Amount & Payment</strong><br>
                The approved loan amount will be paid by EFT or other agreed method. Repayment amounts, dates, and duration will be confirmed in the loan agreement.<br><br>
                
                <strong>3. Interest & Fees</strong><br>
                I agree to pay the interest, fees, and charges as disclosed in the loan agreement. Interest and fees are calculated as agreed and in accordance with applicable South African law.<br><br>
                
                <strong>4. Repayment</strong><br>
                Repayments must be made on or before the due dates without deduction. If a payment date falls on a non-business day, payment is due on the next business day.<br><br>
                
                <strong>5. Late Payment & Default</strong><br>
                If I fail to pay on time or breach this agreement, the full outstanding balance may become immediately due, and legal and collection costs may be charged as permitted by law.<br><br>
                
                <strong>6. National Credit Act</strong><br>
                Where applicable, this loan is subject to the National Credit Act 34 of 2005. Where the transaction is exempt, I acknowledge such exemption.<br><br>
                
                <strong>7. Authority & Consent</strong><br>
                I confirm that I have legal capacity to contract and consent to credit checks, verification of information, and lawful sharing of my data for credit and compliance purposes.<br><br>
                
                <strong>8. Governing Law</strong><br>
                This agreement is governed by the laws of the Republic of South Africa, and I consent to the jurisdiction of South African courts.
            </div>

            <div class="confirmation-box">
                <strong style="color: #2c5aa0;">‚úîÔ∏è Applicant Confirmation</strong><br>
                <label class="checkbox-label" style="margin-top: 10px;">
                    <input type="checkbox" id="acceptTerms" required>
                    <span>I have read, understood, and agree to these Terms & Conditions. *</span>
                </label>
            </div>

            <h2 style="margin-top: 30px;">Client Signature</h2>
            <canvas id="signaturePad" class="signature-pad"></canvas>
            <button type="button" class="btn-secondary" id="clearSignature">Clear Signature</button>

            <button type="submit" class="btn-primary" id="submitBtn">Generate & Download PDF</button>
        </form>
    </div>

    <script>
        // Selfie camera functionality
        const takeSelfieBtn = document.getElementById('takeSelfie');
        const selfieInput = document.getElementById('selfieInput');
        const selfiePreview = document.getElementById('selfiePreview');

        takeSelfieBtn.addEventListener('click', function() {
            selfieInput.click();
        });

        selfieInput.addEventListener('change', function(e) {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    selfiePreview.src = e.target.result;
                    selfiePreview.classList.remove('hidden');
                    takeSelfieBtn.textContent = '‚úì Selfie Captured - Retake?';
                    takeSelfieBtn.style.background = '#4caf50';
                };
                reader.readAsDataURL(this.files[0]);
            }
        });

        // Loan calculation
        const loanAmountInput = document.getElementById('loanAmount');
        
        function calculateLoan() {
            const amount = parseFloat(loanAmountInput.value) || 0;
            
            if (amount > 5000) {
                document.getElementById('displayLoanAmount').textContent = 'R ' + amount.toFixed(2);
                document.getElementById('displayFees').textContent = 'ERROR: Max R5,000';
                document.getElementById('displayTotal').textContent = 'ERROR: Max R5,000';
                loanAmountInput.setCustomValidity('Maximum loan amount is R5,000');
                return;
            } else {
                loanAmountInput.setCustomValidity('');
            }
            
            let interestRate = 0;
            if (amount > 0 && amount <= 2000) {
                interestRate = 0.40;
            } else if (amount > 2000 && amount <= 5000) {
                interestRate = 0.35;
            }
            const fees = amount * interestRate;
            const total = amount + fees;
            document.getElementById('displayLoanAmount').textContent = 'R ' + amount.toFixed(2);
            document.getElementById('displayFees').textContent = 'R ' + fees.toFixed(2);
            document.getElementById('displayTotal').textContent = 'R ' + total.toFixed(2);
        }
        loanAmountInput.addEventListener('input', calculateLoan);

        // Signature pad
        const canvas = document.getElementById('signaturePad');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let hasSignature = false;

        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = 200;
        }
        resizeCanvas();

        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches ? e.touches[0] : e;
            return {
                x: touch.clientX - rect.left,
                y: touch.clientY - rect.top
            };
        }

        function startDrawing(e) {
            e.preventDefault();
            isDrawing = true;
            hasSignature = true;
            const pos = getPos(e);
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        }

        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault();
            const pos = getPos(e);
            ctx.lineTo(pos.x, pos.y);
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.stroke();
        }

        function stopDrawing(e) {
            e.preventDefault();
            isDrawing = false;
        }

        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('touchstart', startDrawing);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', stopDrawing);

        document.getElementById('clearSignature').addEventListener('click', function() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            hasSignature = false;
        });

        // PDF Generation
        document.getElementById('loanForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Generating PDF...';
            
            const amount = parseFloat(document.getElementById('loanAmount').value);
            if (amount > 5000) {
                alert('Maximum loan amount is R5,000. Please enter a lower amount.');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Generate & Download PDF';
                return;
            }
            if (amount < 500) {
                alert('Minimum loan amount is R500. Please enter a higher amount.');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Generate & Download PDF';
                return;
            }
            
            if (!document.getElementById('acceptTerms').checked) {
                alert('You must accept the Terms & Conditions to proceed');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Generate & Download PDF';
                return;
            }
            if (!hasSignature) {
                alert('Please provide your signature');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Generate & Download PDF';
                return;
            }
            if (!selfieInput.files[0]) {
                alert('Please take a selfie');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Generate & Download PDF';
                return;
            }

            // Generate PDF
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            
            // Add content to PDF
            pdf.setFontSize(20);
            pdf.text('CASH CARTEL MICROLENDING', 105, 20, { align: 'center' });
            pdf.setFontSize(14);
            pdf.text('Loan Application', 105, 30, { align: 'center' });
            
            pdf.setFontSize(12);
            let y = 50;
            
            pdf.text('Personal Information:', 20, y);
            y += 10;
            pdf.setFontSize(10);
            pdf.text(`Full Name: ${document.getElementById('fullName').value}`, 20, y);
            y += 7;
            pdf.text(`ID Number: ${document.getElementById('idNumber').value}`, 20, y);
            y += 7;
            pdf.text(`Email: ${document.getElementById('email').value}`, 20, y);
            y += 7;
            pdf.text(`WhatsApp: ${document.getElementById('phone').value}`, 20, y);
            y += 7;
            pdf.text(`Address: ${document.getElementById('address').value}`, 20, y);
            y += 15;
            
            pdf.setFontSize(12);
            pdf.text('Loan Details:', 20, y);
            y += 10;
            pdf.setFontSize(10);
            
            let interestRate = amount <= 2000 ? 0.40 : 0.35;
            let fees = amount * interestRate;
            let total = amount + fees;
            
            pdf.text(`Loan Amount: R${amount.toFixed(2)}`, 20, y);
            y += 7;
            pdf.text(`Total Fees: R${fees.toFixed(2)}`, 20, y);
            y += 7;
            pdf.text(`Total Payable: R${total.toFixed(2)}`, 20, y);
            y += 7;
            pdf.text(`Repayment Date: ${document.getElementById('repaymentDate').value}`, 20, y);
            y += 15;
            
            // Add signature
            pdf.setFontSize(12);
            pdf.text('Client Signature:', 20, y);
            y += 10;
            const signatureData = canvas.toDataURL();
            pdf.addImage(signatureData, 'PNG', 20, y, 80, 30);
            y += 40;
            
            pdf.setFontSize(8);
            pdf.text(`Application Date: ${new Date().toLocaleDateString()}`, 20, y);
            
            // Save PDF
            pdf.save(`Cash_Cartel_Application_${document.getElementById('idNumber').value}.pdf`);
            
            submitBtn.disabled = false;
            submitBtn.textContent = 'Generate & Download PDF';
            alert('PDF Generated Successfully! Check your downloads.');
        });

        // Set minimum date
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('repaymentDate').setAttribute('min', today);
    </script>
</body>
</html>
ENDFILE2
